STRATEGIC DEPENDENCY RESOLUTION - ATTEMPT {{attempt}}/{{maxAttempts}}

TARGET UPGRADES USER WANT TO DO: {{targetPackages}}

REASONING:
{{#if reasoningRecording}}
{{#if reasoningRecording.updateMade}}
{{#each reasoningRecording.updateMade}}
- PREVIOUS UPDATE: {{package.name}} (rank {{package.rank}}) upgraded from {{fromVersion}} to {{toVersion}} to resolve conflict with {{reason.name}} (rank {{reason.rank}})
{{/each}}
{{else}}
- No previous reasoning recorded.
{{/if}}
{{else}}
- No previous reasoning recorded.
{{/if}}

CONFLICT ANALYSIS:
{{#if analysis}}
**CONFLICTING PACKAGE:** "{{analysis.conflictingPackage}}" current version installed v{{analysis.conflictingPackageCurrentVersion}}

**PACKAGES SATISFIED BY CURRENT VERSION:**
{{#each analysis.satisfyingPackages}}
- {{packageName}} ({{tier}}, rank {{rank}}) requires {{requiredVersionRange}}
{{/each}}

**PACKAGES NOT SATISFIED (CAUSING CONFLICT):**
{{#each analysis.notSatisfying}}
- {{packageName}} v{{packageVersion}} ({{tier}}, rank {{rank}}) requires {{requiredVersionRange}}
  Available versions: {{#each availableVersions}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
{{/each}}

**AVAILABLE VERSIONS FOR "{{analysis.conflictingPackage}}":**
{{#each analysis.conflictingPackageAvailableVersions}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
{{else}}
- No conflict analysis available.
{{/if}}

STRATEGIC INSTRUCTIONS:
1. **Conflict Resolution Priority**: When resolving dependency conflicts, prioritize upgrading non-satisfying packages with the LOWEST rank first. Higher-ranked packages (core frameworks, official libraries) should be kept stable, while lower-ranked packages (utilities, experimental) should be upgraded to resolve conflicts.

2. **Package Ranking Strategy**: 
   - CORE_FRAMEWORK (1000+): Never downgrade, upgrade dependents instead
   - OFFICIAL_LIBRARIES (800+): Prefer stability, upgrade only if necessary
   - POPULAR_UTILITIES (600+): Safe to upgrade if it resolves conflicts
   - DEPENDENCY_HEAVY (400+): Upgrade cautiously, check for breaking changes
   - LIGHTWEIGHT (200+): Safe to upgrade aggressively
   - EXPERIMENTAL (100+): First candidates for upgrades or replacements
   - Higher rank packages should influence upgrade decisions for lower rank packages.
   - Higher the rank value, more priority it has in the upgrade decision-making process.
   - Lower rank packages should be upgraded first to resolve conflicts with higher rank packages.

3. **Resolution Logic**:
   - Here the goal is to achieve TARGET UPGRADES USER WANT TO DO.
   - Identify all non-satisfying packages from the conflict analysis, upgrade the lowest-ranked packages first to satisfy the higher-ranked dependencies.
   - Choose versions from the available versions lists ONLY that best resolve the conflicts while adhering to the ranking strategy.
   - If no suitable version is found for a low-rank package, set upgraded version to <NULL>.
   - e.g. {
      "name": "package-name",
      "version": "<NULL>",
      "isDev": true/false,
      "reason": "no suitable version found to resolve conflict with higher-ranked package",
      "fromVersion": "current-version"
    }

4. **Available Versions Strategy**: 
   - Use the `availableVersions` arrays from the conflict analysis to make informed upgrade decisions
   - For conflicting packages, choose from `conflictingPackageAvailableVersions` to find compatible versions
   - For satisfying/non-satisfying packages, use their `availableVersions` to select appropriate versions
   - Prefer stable/LTS versions when available, avoid pre-release versions unless necessary

5. **Reasoning Recording**: 
   - Consider the previous reasoning record to understand what upgrades have already been made and why
   - For each new upgrade suggestion, provide reasoning that explains:
     * Which package is being upgraded (with its rank)
     * Which higher-ranked package(s) it's conflicting with that necessitated this upgrade
     * Why this specific version was chosen to resolve the conflict (from available versions)
   - Never upgrade higher rank packages to satisfy lower rank ones.
   - Build upon previous reasoning to create a comprehensive upgrade strategy

Respond with JSON containing strategic upgrade suggestions:
{
  "suggestions": [
    {
      "name": "package-name",
      "version": "suggested-version",
      "isDev": true/false,
      "reason": "strategic rationale for this upgrade",
      "fromVersion": "current-version"
    }
  ],
  "analysis": "strategic analysis of the conflict and resolution approach",
  "reasoning": {
    "updateMade": [
      {
        "package": {
          "name": "package-being-upgraded",
          "rank": 200
        },
        "fromVersion": "1.0.0",
        "toVersion": "2.0.0",
        "reason": {
          "name": "higher-ranked-package-causing-conflict",
          "rank": 800
        }
      }
    ]
  }
}
