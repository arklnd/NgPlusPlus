STRATEGIC DEPENDENCY RESOLUTION - ATTEMPT {{attempt}}/{{maxAttempts}}

TARGET UPGRADES USER WANT TO DO: {{targetPackages}}

REASONING:
{{#if reasoningRecording}}
- PREVIOUS RECORDING: {{reasoningRecording}}
{{else}}
- No previous reasoning recorded.
{{/if}}

INSTALLATION ERROR:
{{errorOutput}}

CONFLICT ANALYSIS:
{{#if analysis}}
{{analysis}}
{{else}}
- No conflict analysis available.
{{/if}}

STRATEGIC INSTRUCTIONS:
1. **Conflict Resolution Priority**: When resolving dependency conflicts, prioritize upgrading non-satisfying packages with the LOWEST rank first. Higher-ranked packages (core frameworks, official libraries) should be kept stable, while lower-ranked packages (utilities, experimental) should be upgraded to resolve conflicts.

2. **Package Ranking Strategy**: 
   - CORE_FRAMEWORK (1000+): Never downgrade, upgrade dependents instead
   - OFFICIAL_LIBRARIES (800+): Prefer stability, upgrade only if necessary
   - POPULAR_UTILITIES (600+): Safe to upgrade if it resolves conflicts
   - DEPENDENCY_HEAVY (400+): Upgrade cautiously, check for breaking changes
   - LIGHTWEIGHT (200+): Safe to upgrade aggressively
   - EXPERIMENTAL (100+): First candidates for upgrades or replacements

3. **Resolution Logic**: Identify all non-satisfying packages from the conflict analysis, upgrade the lowest-ranked packages first to satisfy the higher-ranked dependencies.

4. **Available Versions Strategy**: 
   - Use the `availableVersions` arrays from the conflict analysis to make informed upgrade decisions
   - For conflicting packages, choose from `conflictingPackageAvailableVersions` to find compatible versions
   - For satisfying/non-satisfying packages, use their `availableVersions` to select appropriate versions
   - Prefer stable/LTS versions when available, avoid pre-release versions unless necessary

5. **Reasoning Recording**: 
   - Consider the previous reasoning record to understand what upgrades have already been made and why
   - For each new upgrade suggestion, provide reasoning that explains:
     * Which package is being upgraded (with its rank)
     * Which higher-ranked package(s) it's conflicting with that necessitated this upgrade
     * Why this specific version was chosen to resolve the conflict (from available versions)
   - Build upon previous reasoning to create a comprehensive upgrade strategy

Respond with JSON containing strategic upgrade suggestions:
{
  "suggestions": [
    {
      "name": "package-name",
      "version": "suggested-version",
      "isDev": true/false,
      "reason": "strategic rationale for this upgrade",
      "fromVersion": "current-version"
    }
  ],
  "analysis": "strategic analysis of the conflict and resolution approach",
  "reasoning": {
    "updateMade": [
      {
        "package": {
          "name": "package-being-upgraded",
          "rank": 200
        },
        "fromVersion": "1.0.0",
        "toVersion": "2.0.0",
        "reason": {
          "name": "higher-ranked-package-causing-conflict",
          "rank": 800
        }
      }
    ]
  }
}